---
export interface Props {
  variant?: 'subtle' | 'prominent' | 'animated';
  color?: 'green' | 'amber' | 'blue' | 'multi';
  density?: 'low' | 'medium' | 'high';
  animated?: boolean;
  opacity?: number;
}

const {
  variant = 'subtle',
  color = 'green',
  density = 'medium',
  animated = true,
  opacity = 0.1
} = Astro.props;

const colorSchemes = {
  green: {
    primary: '#00ff41',
    secondary: '#00cc33',
    accent: '#008822'
  },
  amber: {
    primary: '#ffb000',
    secondary: '#ff9500',
    accent: '#cc7700'
  },
  blue: {
    primary: '#00bfff',
    secondary: '#0099cc',
    accent: '#007799'
  },
  multi: {
    primary: '#00ff41',
    secondary: '#ffb000',
    accent: '#00bfff'
  }
};

const colors = colorSchemes[color];

const densitySettings = {
  low: { size: 80, nodes: 6 },
  medium: { size: 50, nodes: 8 },
  high: { size: 30, nodes: 12 }
};

const settings = densitySettings[density];
---

<div class={`circuit-background ${variant} ${color} ${density} ${animated ? 'animated' : ''}`}
     style={`--opacity: ${opacity}; --primary: ${colors.primary}; --secondary: ${colors.secondary}; --accent: ${colors.accent};`}>

  <!-- Main circuit grid -->
  <div class="circuit-grid"></div>

  <!-- Connection nodes -->
  <div class="circuit-nodes"></div>

  <!-- Electronic components -->
  <div class="circuit-components">
    <div class="component resistor" style="top: 20%; left: 15%;"></div>
    <div class="component capacitor" style="top: 35%; left: 60%;"></div>
    <div class="component chip" style="top: 70%; left: 25%;"></div>
    <div class="component led" style="top: 45%; left: 80%;"></div>
    <div class="component transistor" style="top: 80%; left: 70%;"></div>
  </div>

  <!-- Flowing data lines -->
  <div class="data-flow"></div>
</div>

<style define:vars={{ size: `${settings.size}px`, nodeCount: settings.nodes }}>
  .circuit-background {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    overflow: hidden;
    pointer-events: none;
    z-index: 0;
  }

  /* Circuit Grid Pattern */
  .circuit-grid {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image:
      /* Horizontal lines */
      linear-gradient(90deg, transparent 49%, var(--primary) 50%, transparent 51%),
      /* Vertical lines */
      linear-gradient(0deg, transparent 49%, var(--primary) 50%, transparent 51%),
      /* Junction dots */
      radial-gradient(circle at 50% 50%, var(--secondary) 1px, transparent 2px),
      /* Micro traces */
      linear-gradient(45deg, transparent 48%, var(--accent) 49%, transparent 50%);
    background-size:
      var(--size) var(--size),
      var(--size) var(--size),
      var(--size) var(--size),
      calc(var(--size) / 2) calc(var(--size) / 2);
    opacity: var(--opacity);
  }

  /* Animated flowing effect */
  .circuit-background.animated .circuit-grid {
    animation: circuitFlow 30s linear infinite;
  }

  @keyframes circuitFlow {
    0% {
      background-position: 0 0, 0 0, 0 0, 0 0;
    }
    100% {
      background-position:
        var(--size) var(--size),
        var(--size) var(--size),
        var(--size) var(--size),
        calc(var(--size) / 2) calc(var(--size) / 2);
    }
  }

  /* Connection Nodes */
  .circuit-nodes {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
  }

  .circuit-nodes::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image:
      radial-gradient(circle at 25% 25%, var(--primary) 2px, transparent 3px),
      radial-gradient(circle at 75% 25%, var(--secondary) 1.5px, transparent 2.5px),
      radial-gradient(circle at 25% 75%, var(--accent) 1.5px, transparent 2.5px),
      radial-gradient(circle at 75% 75%, var(--primary) 2px, transparent 3px);
    background-size: calc(var(--size) * 2) calc(var(--size) * 2);
    opacity: calc(var(--opacity) * 2);
  }

  /* Electronic Components */
  .circuit-components {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
  }

  .component {
    position: absolute;
    opacity: calc(var(--opacity) * 3);
    transform: translate(-50%, -50%);
  }

  /* Resistor */
  .resistor {
    width: 20px;
    height: 6px;
    background:
      linear-gradient(90deg,
        transparent 0%,
        var(--primary) 20%,
        var(--secondary) 40%,
        var(--primary) 60%,
        var(--secondary) 80%,
        transparent 100%);
    border-radius: 1px;
  }

  .resistor::before {
    content: '';
    position: absolute;
    top: 50%;
    left: -5px;
    right: -5px;
    height: 1px;
    background: var(--primary);
    transform: translateY(-50%);
  }

  /* Capacitor */
  .capacitor {
    width: 2px;
    height: 12px;
    background: var(--secondary);
    border-radius: 1px;
  }

  .capacitor::before {
    content: '';
    position: absolute;
    top: 0;
    right: -4px;
    width: 2px;
    height: 12px;
    background: var(--secondary);
    border-radius: 1px;
  }

  /* Microchip */
  .chip {
    width: 16px;
    height: 12px;
    background: var(--primary);
    border-radius: 2px;
    position: relative;
  }

  .chip::before,
  .chip::after {
    content: '';
    position: absolute;
    top: 50%;
    width: 3px;
    height: 1px;
    background: var(--primary);
    transform: translateY(-50%);
  }

  .chip::before {
    left: -3px;
  }

  .chip::after {
    right: -3px;
  }

  /* LED */
  .led {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: radial-gradient(circle, var(--accent), transparent);
    box-shadow: 0 0 6px var(--accent);
  }

  /* Transistor */
  .transistor {
    width: 0;
    height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-bottom: 10px solid var(--secondary);
    border-radius: 1px;
  }

  /* Data Flow Animation */
  .data-flow {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background:
      linear-gradient(90deg,
        transparent 0%,
        var(--primary) 1%,
        transparent 2%),
      linear-gradient(0deg,
        transparent 0%,
        var(--secondary) 1%,
        transparent 2%);
    background-size: 200px 1px, 1px 200px;
    opacity: calc(var(--opacity) * 0.5);
  }

  .circuit-background.animated .data-flow {
    animation: dataFlow 8s linear infinite;
  }

  @keyframes dataFlow {
    0% {
      background-position: -200px 0, 0 -200px;
    }
    100% {
      background-position: calc(100% + 200px) 0, 0 calc(100% + 200px);
    }
  }

  /* Component animations */
  .circuit-background.animated .led {
    animation: ledBlink 3s ease-in-out infinite;
  }

  @keyframes ledBlink {
    0%, 80%, 100% {
      opacity: calc(var(--opacity) * 3);
      box-shadow: 0 0 6px var(--accent);
    }
    85%, 95% {
      opacity: calc(var(--opacity) * 6);
      box-shadow: 0 0 12px var(--accent);
    }
  }

  /* Variant Styles */
  .circuit-background.prominent {
    --opacity: 0.2;
  }

  .circuit-background.subtle {
    --opacity: 0.05;
  }

  /* Density Variations */
  .circuit-background.high .circuit-grid {
    background-size: 30px 30px, 30px 30px, 30px 30px, 15px 15px;
  }

  .circuit-background.low .circuit-grid {
    background-size: 80px 80px, 80px 80px, 80px 80px, 40px 40px;
  }

  /* Multi-color variant */
  .circuit-background.multi .circuit-grid {
    background-image:
      linear-gradient(90deg, transparent 49%, var(--primary) 50%, transparent 51%),
      linear-gradient(0deg, transparent 49%, var(--secondary) 50%, transparent 51%),
      radial-gradient(circle at 50% 50%, var(--accent) 1px, transparent 2px),
      linear-gradient(45deg, transparent 48%, var(--primary) 49%, transparent 50%);
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    .circuit-background.high {
      --size: 40px;
    }

    .circuit-background.medium {
      --size: 60px;
    }

    .circuit-background.low {
      --size: 100px;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .circuit-grid,
    .data-flow,
    .led {
      animation: none;
    }
  }

  /* High contrast mode */
  @media (prefers-contrast: high) {
    .circuit-background {
      --opacity: 0.3;
    }
  }
</style>
