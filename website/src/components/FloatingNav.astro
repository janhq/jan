---
export interface Props {
  sections?: Array<{
    id: string;
    label: string;
    icon: string;
    status?: 'active' | 'inactive' | 'processing';
  }>;
  position?: 'left' | 'right';
  theme?: 'dark' | 'matrix' | 'circuit';
  compact?: boolean;
}

const {
  sections = [
    { id: 'models', label: 'Models', icon: 'ðŸ§ ', status: 'active' },
    { id: 'platforms', label: 'Platforms', icon: 'ðŸ’»', status: 'active' },
    { id: 'tools', label: 'Tools', icon: 'ðŸ”§', status: 'processing' }
  ],
  position = 'right',
  theme = 'matrix',
  compact = false
} = Astro.props;

const navId = `floating-nav-${Math.random().toString(36).substr(2, 9)}`;
---

<div id={navId} class={`floating-nav ${position} ${theme} ${compact ? 'compact' : ''}`}>
  <!-- Main Navigation Button -->
  <button class="nav-toggle" aria-label="Toggle Navigation">
    <div class="nav-icon">
      <span class="icon-line"></span>
      <span class="icon-line"></span>
      <span class="icon-line"></span>
    </div>
    <div class="status-ring"></div>
  </button>

  <!-- Navigation Menu -->
  <nav class="nav-menu" role="navigation" aria-label="Section Navigation">
    <div class="nav-header">
      <div class="terminal-prompt">
        <span class="prompt-symbol">></span>
        <span class="prompt-text">NAVIGATE</span>
        <span class="terminal-cursor"></span>
      </div>
      <div class="system-status">
        <div class="status-indicator online"></div>
        <span class="status-text">ONLINE</span>
      </div>
    </div>

    <ul class="nav-list">
      {sections.map((section, index) => (
        <li class="nav-item">
          <a href={`#${section.id}`} class="nav-link" data-section={section.id}>
            <div class="nav-icon-wrapper">
              <span class="nav-emoji">{section.icon}</span>
              <div class="connection-line"></div>
            </div>
            <div class="nav-content">
              <span class="nav-label">{section.label}</span>
              <div class="nav-circuit">
                <div class="circuit-dot"></div>
                <div class="circuit-line"></div>
              </div>
            </div>
            <div class={`nav-status ${section.status || 'inactive'}`}>
              <div class="status-dot"></div>
              <span class="status-code">
                {section.status === 'active' ? '200' :
                 section.status === 'processing' ? '102' : '404'}
              </span>
            </div>
          </a>
        </li>
      ))}
    </ul>

    <div class="nav-footer">
      <div class="progress-bar">
        <div class="progress-fill"></div>
      </div>
      <div class="system-info">
        <span class="timestamp"></span>
        <span class="version">v2.4.1</span>
      </div>
    </div>
  </nav>

  <!-- Background Circuit Pattern -->
  <div class="nav-background">
    <div class="circuit-pattern"></div>
    <div class="data-stream"></div>
  </div>
</div>

<style>
  .floating-nav {
    position: fixed;
    top: 50%;
    transform: translateY(-50%);
    z-index: 1000;
    font-family: 'JetBrains Mono', 'Monaco', 'Menlo', monospace;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .floating-nav.right {
    right: 20px;
  }

  .floating-nav.left {
    left: 20px;
  }

  /* Main Toggle Button */
  .nav-toggle {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background:
      radial-gradient(circle at 30% 30%, rgba(0, 255, 65, 0.1), transparent),
      linear-gradient(135deg, #1a1a1a, #0a0a0a);
    border: 2px solid #00ff41;
    cursor: pointer;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    box-shadow:
      0 4px 20px rgba(0, 0, 0, 0.3),
      0 0 20px rgba(0, 255, 65, 0.2);
  }

  .nav-toggle:hover {
    transform: scale(1.1);
    box-shadow:
      0 6px 30px rgba(0, 0, 0, 0.4),
      0 0 30px rgba(0, 255, 65, 0.4);
    border-color: #00ff65;
  }

  .nav-icon {
    display: flex;
    flex-direction: column;
    gap: 4px;
    transition: all 0.3s ease;
  }

  .icon-line {
    width: 20px;
    height: 2px;
    background: #00ff41;
    border-radius: 1px;
    transition: all 0.3s ease;
    box-shadow: 0 0 5px rgba(0, 255, 65, 0.5);
  }

  .floating-nav.active .icon-line:nth-child(1) {
    transform: rotate(45deg) translate(6px, 6px);
  }

  .floating-nav.active .icon-line:nth-child(2) {
    opacity: 0;
    transform: translateX(20px);
  }

  .floating-nav.active .icon-line:nth-child(3) {
    transform: rotate(-45deg) translate(6px, -6px);
  }

  .status-ring {
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    border: 1px solid transparent;
    border-radius: 50%;
    background:
      linear-gradient(45deg, #00ff41, transparent, #ffb000, transparent, #00ff41)
      border-box;
    mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    animation: statusRotate 4s linear infinite;
  }

  @keyframes statusRotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Navigation Menu */
  .nav-menu {
    position: absolute;
    right: 80px;
    top: 50%;
    transform: translateY(-50%);
    background:
      linear-gradient(135deg, rgba(26, 26, 26, 0.95), rgba(10, 10, 10, 0.98));
    border: 1px solid #00ff41;
    border-radius: 8px;
    min-width: 280px;
    backdrop-filter: blur(10px);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-50%) translateX(20px) scale(0.95);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow:
      0 10px 40px rgba(0, 0, 0, 0.5),
      0 0 20px rgba(0, 255, 65, 0.1);
  }

  .floating-nav.left .nav-menu {
    right: auto;
    left: 80px;
    transform: translateY(-50%) translateX(-20px) scale(0.95);
  }

  .floating-nav.active .nav-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(-50%) translateX(0) scale(1);
  }

  /* Menu Header */
  .nav-header {
    padding: 1rem;
    border-bottom: 1px solid rgba(0, 255, 65, 0.2);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .terminal-prompt {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #00ff41;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .prompt-symbol {
    color: #ffb000;
  }

  .terminal-cursor {
    width: 8px;
    height: 12px;
    background: #ffffff;
    animation: cursorBlink 1s infinite;
  }

  @keyframes cursorBlink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }

  .system-status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.7rem;
    color: #888888;
  }

  .status-indicator {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #00ff41;
    box-shadow: 0 0 8px #00ff41;
    animation: statusPulse 2s infinite;
  }

  @keyframes statusPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  /* Navigation List */
  .nav-list {
    list-style: none;
    margin: 0;
    padding: 0.5rem 0;
  }

  .nav-item {
    margin: 0;
  }

  .nav-link {
    display: flex;
    align-items: center;
    padding: 0.75rem 1rem;
    color: #cccccc;
    text-decoration: none;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .nav-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(0, 255, 65, 0.1),
      transparent
    );
    transition: left 0.5s ease;
  }

  .nav-link:hover::before {
    left: 100%;
  }

  .nav-link:hover {
    color: #00ff41;
    background: rgba(0, 255, 65, 0.05);
    transform: translateX(5px);
  }

  .nav-icon-wrapper {
    display: flex;
    align-items: center;
    margin-right: 1rem;
    position: relative;
  }

  .nav-emoji {
    font-size: 1.2rem;
    display: block;
    filter: grayscale(0.3);
    transition: all 0.3s ease;
  }

  .nav-link:hover .nav-emoji {
    filter: grayscale(0);
    transform: scale(1.1);
  }

  .connection-line {
    position: absolute;
    right: -8px;
    top: 50%;
    width: 16px;
    height: 1px;
    background: #333333;
    transform: translateY(-50%);
    transition: all 0.3s ease;
  }

  .nav-link:hover .connection-line {
    background: #00ff41;
    box-shadow: 0 0 5px #00ff41;
  }

  .nav-content {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .nav-label {
    font-size: 0.9rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .nav-circuit {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .circuit-dot {
    width: 4px;
    height: 4px;
    border-radius: 50%;
    background: #666666;
    transition: all 0.3s ease;
  }

  .nav-link:hover .circuit-dot {
    background: #00ff41;
    box-shadow: 0 0 8px #00ff41;
  }

  .circuit-line {
    width: 12px;
    height: 1px;
    background: #333333;
    transition: all 0.3s ease;
  }

  .nav-link:hover .circuit-line {
    background: #00ff41;
    box-shadow: 0 0 5px #00ff41;
  }

  .nav-status {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    margin-left: 0.5rem;
  }

  .nav-status .status-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
  }

  .nav-status.active .status-dot {
    background: #00ff41;
    box-shadow: 0 0 6px #00ff41;
  }

  .nav-status.processing .status-dot {
    background: #ffb000;
    box-shadow: 0 0 6px #ffb000;
    animation: processingPulse 1s infinite;
  }

  .nav-status.inactive .status-dot {
    background: #666666;
  }

  @keyframes processingPulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.7; transform: scale(1.2); }
  }

  .status-code {
    color: #888888;
    font-size: 0.6rem;
  }

  .nav-status.active .status-code {
    color: #00ff41;
  }

  .nav-status.processing .status-code {
    color: #ffb000;
  }

  /* Menu Footer */
  .nav-footer {
    padding: 0.75rem 1rem;
    border-top: 1px solid rgba(0, 255, 65, 0.2);
  }

  .progress-bar {
    width: 100%;
    height: 3px;
    background: #333333;
    border-radius: 2px;
    overflow: hidden;
    margin-bottom: 0.5rem;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #00ff41, #ffb000);
    border-radius: 2px;
    animation: progressFlow 3s ease-in-out infinite;
  }

  @keyframes progressFlow {
    0% { width: 0%; }
    50% { width: 100%; }
    100% { width: 0%; }
  }

  .system-info {
    display: flex;
    justify-content: space-between;
    font-size: 0.7rem;
    color: #666666;
  }

  /* Background Effects */
  .nav-background {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    overflow: hidden;
    border-radius: 8px;
  }

  .circuit-pattern {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background:
      linear-gradient(90deg, transparent 49%, rgba(0, 255, 65, 0.05) 50%, transparent 51%),
      linear-gradient(0deg, transparent 49%, rgba(0, 255, 65, 0.05) 50%, transparent 51%);
    background-size: 20px 20px;
    opacity: 0.3;
  }

  .data-stream {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
      45deg,
      transparent 30%,
      rgba(0, 255, 65, 0.02) 50%,
      transparent 70%
    );
    animation: dataStreamFlow 4s linear infinite;
  }

  @keyframes dataStreamFlow {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  /* Theme Variations */
  .floating-nav.matrix .nav-toggle {
    border-color: #00ff41;
    box-shadow:
      0 4px 20px rgba(0, 0, 0, 0.3),
      0 0 20px rgba(0, 255, 65, 0.3);
  }

  .floating-nav.circuit .nav-toggle {
    border-color: #ffb000;
    box-shadow:
      0 4px 20px rgba(0, 0, 0, 0.3),
      0 0 20px rgba(255, 176, 0, 0.3);
  }

  .floating-nav.circuit .nav-menu {
    border-color: #ffb000;
  }

  /* Compact Mode */
  .floating-nav.compact .nav-toggle {
    width: 50px;
    height: 50px;
  }

  .floating-nav.compact .nav-menu {
    min-width: 240px;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .floating-nav {
      right: 10px;
    }

    .floating-nav.left {
      left: 10px;
    }

    .nav-menu {
      min-width: 260px;
      right: 60px;
    }

    .floating-nav.left .nav-menu {
      left: 60px;
    }

    .nav-toggle {
      width: 50px;
      height: 50px;
    }
  }

  @media (max-width: 480px) {
    .nav-menu {
      min-width: 240px;
      font-size: 0.85rem;
    }

    .nav-link {
      padding: 0.6rem 0.8rem;
    }
  }

  /* Accessibility */
  @media (prefers-reduced-motion: reduce) {
    .floating-nav *,
    .floating-nav *::before,
    .floating-nav *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  .nav-toggle:focus,
  .nav-link:focus {
    outline: 2px solid #00ff41;
    outline-offset: 2px;
  }

  /* High contrast mode */
  @media (prefers-contrast: high) {
    .floating-nav {
      filter: contrast(1.5);
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const navs = document.querySelectorAll('.floating-nav');

    navs.forEach(nav => {
      const toggle = nav.querySelector('.nav-toggle');
      const menu = nav.querySelector('.nav-menu');
      const links = nav.querySelectorAll('.nav-link');
      const timestamp = nav.querySelector('.timestamp');

      // Update timestamp
      if (timestamp) {
        const updateTime = () => {
          const now = new Date();
          timestamp.textContent = now.toLocaleTimeString('en-US', {
            hour12: false,
            hour: '2-digit',
            minute: '2-digit'
          });
        };
        updateTime();
        setInterval(updateTime, 1000);
      }

      // Toggle menu
      toggle?.addEventListener('click', () => {
        nav.classList.toggle('active');
      });

      // Close menu when clicking outside
      document.addEventListener('click', (e) => {
        if (!nav.contains(e.target)) {
          nav.classList.remove('active');
        }
      });

      // Handle navigation
      links.forEach(link => {
        link.addEventListener('click', (e) => {
          e.preventDefault();
          const sectionId = link.getAttribute('data-section');
          const targetSection = document.getElementById(sectionId);

          if (targetSection) {
            // Smooth scroll with GSAP if available
            if (typeof gsap !== 'undefined') {
              gsap.to(window, {
                duration: 1.2,
                scrollTo: { y: targetSection, offsetY: 100 },
                ease: 'power3.inOut'
              });
            } else {
              targetSection.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
              });
            }

            // Close menu after navigation
            nav.classList.remove('active');

            // Add ripple effect
            const rect = link.getBoundingClientRect();
            const ripple = document.createElement('div');
            ripple.style.cssText = `
              position: absolute;
              border-radius: 50%;
              background: rgba(0, 255, 65, 0.3);
              transform: scale(0);
              animation: ripple 0.6s linear;
              left: ${e.clientX - rect.left - 10}px;
              top: ${e.clientY - rect.top - 10}px;
              width: 20px;
              height: 20px;
              pointer-events: none;
              z-index: 10;
            `;

            link.appendChild(ripple);
            setTimeout(() => ripple.remove(), 600);
          }
        });
      });

      // Keyboard navigation
      nav.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          nav.classList.remove('active');
          toggle?.focus();
        }
      });
    });

    // Add ripple animation styles
    const style = document.createElement('style');
    style.textContent = `
      @keyframes ripple {
        to {
          transform: scale(4);
          opacity: 0;
        }
      }
    `;
    document.head.appendChild(style);
  });
</script>
